{"version":3,"file":"useEditableDiscovery.js","names":["discover","callback","element","documentElement","x","scrollLeft","y","scrollTop","editables","querySelectorAll","EDITABLE_SELECTOR","result","offset","forEach","item","entry","ref","getAttribute","EDITABLE_ATTRIBUTE","rect","getBoundingClientRect","push","useEditableDiscovery","EDITABLE_DISCOVERY_DEFAULT_OPTIONS","useState","setEditables","useWindowSize","windowSize","useDebouncedCallback","DISCOVERY_DEBOUNCE_MS","useLayoutEffect","useMutationObserver"],"sources":["../../src/hooks/useEditableDiscovery.ts"],"sourcesContent":["/*\n * Copyright 2022 Adobe. All rights reserved.\n * This file is licensed to you under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License. You may obtain a copy\n * of the License at http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software distributed under\n * the License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\n * OF ANY KIND, either express or implied. See the License for the specific language\n * governing permissions and limitations under the License.\n */\n\nimport { useState, useLayoutEffect } from \"react\";\nimport { useDebouncedCallback } from \"use-debounce\";\nimport { useMutationObserver } from \"./useMutationObserver\";\nimport { useWindowSize } from \"./useWindowSize\";\nimport { EditableDiscoveryHookParams, EditablesList } from \"../types\";\nimport {\n  DISCOVERY_DEBOUNCE_MS,\n  EDITABLE_ATTRIBUTE,\n  EDITABLE_DISCOVERY_DEFAULT_OPTIONS,\n  EDITABLE_SELECTOR,\n} from \"../constants\";\n\nconst discover = (callback, element): EditablesList => {\n  const { scrollLeft: x, scrollTop: y } = element.documentElement;\n  const editables = element.querySelectorAll(EDITABLE_SELECTOR) || [];\n  const result: EditablesList = {\n    editables: [],\n    offset: { x, y },\n  };\n\n  editables.forEach((item) => {\n    const entry = {\n      ref: item.getAttribute(EDITABLE_ATTRIBUTE) || \"\",\n      rect: item.getBoundingClientRect(),\n    };\n\n    result.editables.push(entry);\n  });\n\n  callback(result);\n  return result;\n};\n\nconst useEditableDiscovery = ({ element }: EditableDiscoveryHookParams = EDITABLE_DISCOVERY_DEFAULT_OPTIONS): {\n  editables: EditablesList;\n} => {\n  const [editables, setEditables] = useState<EditablesList>({ editables: [], offset: { x: 0, y: 0 } });\n  const { windowSize } = useWindowSize();\n  const callback = useDebouncedCallback(() => {\n    discover(setEditables, element);\n  }, DISCOVERY_DEBOUNCE_MS);\n\n  // discover when: window is resized\n  useLayoutEffect(() => callback(), [callback, windowSize]);\n\n  // discover when: content mutation observer is triggered\n  useMutationObserver({ element, callback });\n\n  return { editables };\n};\n\nexport { useEditableDiscovery };\n"],"mappings":";;;;;;;AAYA;;AACA;;AACA;;AACA;;AAEA;;;;;;;;;;;;;;AAOA,IAAMA,QAAQ,GAAG,SAAXA,QAAW,CAACC,QAAD,EAAWC,OAAX,EAAsC;EACrD,4BAAwCA,OAAO,CAACC,eAAhD;EAAA,IAAoBC,CAApB,yBAAQC,UAAR;EAAA,IAAkCC,CAAlC,yBAAuBC,SAAvB;EACA,IAAMC,SAAS,GAAGN,OAAO,CAACO,gBAAR,CAAyBC,4BAAzB,KAA+C,EAAjE;EACA,IAAMC,MAAqB,GAAG;IAC5BH,SAAS,EAAE,EADiB;IAE5BI,MAAM,EAAE;MAAER,CAAC,EAADA,CAAF;MAAKE,CAAC,EAADA;IAAL;EAFoB,CAA9B;EAKAE,SAAS,CAACK,OAAV,CAAkB,UAACC,IAAD,EAAU;IAC1B,IAAMC,KAAK,GAAG;MACZC,GAAG,EAAEF,IAAI,CAACG,YAAL,CAAkBC,6BAAlB,KAAyC,EADlC;MAEZC,IAAI,EAAEL,IAAI,CAACM,qBAAL;IAFM,CAAd;IAKAT,MAAM,CAACH,SAAP,CAAiBa,IAAjB,CAAsBN,KAAtB;EACD,CAPD;EASAd,QAAQ,CAACU,MAAD,CAAR;EACA,OAAOA,MAAP;AACD,CAnBD;;AAqBA,IAAMW,oBAAoB,GAAG,SAAvBA,oBAAuB,GAExB;EAAA,+EAFoEC,6CAEpE;EAAA,IAF2BrB,OAE3B,QAF2BA,OAE3B;;EACH,gBAAkC,IAAAsB,eAAA,EAAwB;IAAEhB,SAAS,EAAE,EAAb;IAAiBI,MAAM,EAAE;MAAER,CAAC,EAAE,CAAL;MAAQE,CAAC,EAAE;IAAX;EAAzB,CAAxB,CAAlC;EAAA;EAAA,IAAOE,SAAP;EAAA,IAAkBiB,YAAlB;;EACA,qBAAuB,IAAAC,6BAAA,GAAvB;EAAA,IAAQC,UAAR,kBAAQA,UAAR;;EACA,IAAM1B,QAAQ,GAAG,IAAA2B,iCAAA,EAAqB,YAAM;IAC1C5B,QAAQ,CAACyB,YAAD,EAAevB,OAAf,CAAR;EACD,CAFgB,EAEd2B,gCAFc,CAAjB,CAHG,CAOH;;EACA,IAAAC,sBAAA,EAAgB;IAAA,OAAM7B,QAAQ,EAAd;EAAA,CAAhB,EAAkC,CAACA,QAAD,EAAW0B,UAAX,CAAlC,EARG,CAUH;;EACA,IAAAI,wCAAA,EAAoB;IAAE7B,OAAO,EAAPA,OAAF;IAAWD,QAAQ,EAARA;EAAX,CAApB;EAEA,OAAO;IAAEO,SAAS,EAATA;EAAF,CAAP;AACD,CAhBD"}