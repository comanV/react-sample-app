{"version":3,"file":"FrameDetails.js","names":["details","viewport","width","height","frame","scroll","x","y","notifyEditor","editor","updateFrameDetails","scrollObserver","target","html","documentElement","scrollLeft","scrollTop","resizeObserver","viewportWidth","Math","max","document","clientWidth","innerWidth","viewportHeight","clientHeight","innerHeight","getBoundingClientRect","frameWidth","frameHeight","ceil","runFrameDetailsObserver","window","addEventListener","debounce","DISCOVERY_DEBOUNCE_MS","bodyResizeHandler","bodyResizeObserver","ResizeObserver","observe","body","requestAnimationFrame"],"sources":["../src/FrameDetails.ts"],"sourcesContent":["/*\n * Copyright 2022 Adobe. All rights reserved.\n * This file is licensed to you under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License. You may obtain a copy\n * of the License at http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software distributed under\n * the License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\n * OF ANY KIND, either express or implied. See the License for the specific language\n * governing permissions and limitations under the License.\n */\n\nimport { debounce } from \"debounce\";\nimport { DISCOVERY_DEBOUNCE_MS } from \"./constants\";\nimport { EditorApi } from \"./types\";\n\nconst details = {\n  viewport: {\n    width: 0,\n    height: 0,\n  },\n  frame: {\n    width: 0,\n    height: 0,\n  },\n  scroll: {\n    x: 0,\n    y: 0,\n  },\n};\n\nconst notifyEditor = ({ editor }) => {\n  editor?.updateFrameDetails({ details });\n};\n\nconst scrollObserver = ({ target }) => {\n  const html = target.documentElement;\n  details.scroll.x = html.scrollLeft;\n  details.scroll.y = html.scrollTop;\n};\n\nconst resizeObserver = ({ target }) => {\n  const viewportWidth = Math.max(target.document.documentElement.clientWidth || 0, target.innerWidth || 0);\n  const viewportHeight = Math.max(target.document.documentElement.clientHeight || 0, target.innerHeight || 0);\n  const { width: frameWidth, height: frameHeight } = target.document.documentElement.getBoundingClientRect();\n  details.viewport = { width: viewportWidth, height: viewportHeight };\n  details.frame = { width: Math.ceil(frameWidth), height: Math.ceil(frameHeight) };\n};\n\nconst runFrameDetailsObserver = ({ editor }: EditorApi): void => {\n  const frame = window;\n\n  frame.document.addEventListener(\n    \"scroll\",\n    debounce(({ target }) => {\n      scrollObserver({ target });\n      notifyEditor({ editor });\n    }, DISCOVERY_DEBOUNCE_MS),\n  );\n\n  frame.addEventListener(\n    \"resize\",\n    debounce(({ target }) => {\n      resizeObserver({ target });\n      notifyEditor({ editor });\n    }, DISCOVERY_DEBOUNCE_MS),\n  );\n\n  frame.addEventListener(\n    \"orientationchange\",\n    debounce(({ target }) => {\n      scrollObserver({ target: frame.document });\n      resizeObserver({ target });\n      notifyEditor({ editor });\n    }, DISCOVERY_DEBOUNCE_MS),\n  );\n\n  // body size observer to handle slow or lazy loading pages, changing their dimensions unexpectedly\n  const bodyResizeHandler = () => {\n    resizeObserver({ target: frame });\n    notifyEditor({ editor });\n  };\n\n  const bodyResizeObserver = new ResizeObserver(debounce(bodyResizeHandler, DISCOVERY_DEBOUNCE_MS));\n  bodyResizeObserver.observe(frame.document.body);\n\n  // compute initial details and notify editor\n  requestAnimationFrame(() => {\n    scrollObserver({ target: frame.document });\n    resizeObserver({ target: frame });\n    notifyEditor({ editor });\n  });\n};\n\nexport { runFrameDetailsObserver };\n"],"mappings":"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"}